<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Oversight Dashboard</title>
<link rel="stylesheet" type="text/css" href="/css/fonts.css" />
<link rel="stylesheet" type="text/css" href="/css/dashboard.css" />
<link rel="shortcut icon" href="/favicon.png" />
<script src="/scripts/jquery.min.js"></script>
</head>
<body>
<h1>Oversight Dashboard</h1>
<ul class="accordion">
  <% for (var i = 0; i < results.hits.hits.length; i++) { %>
    <% var hit = results.hits.hits[i]; %>
    <li class="severity-<%= hit._source.severity %>">
      <a href="javascript:void(0)" class="js-accordion-trigger">
        <%= hit._id %>
      </a>
      <ul class="submenu">
        <li>
          <%= hit._source.report_count %> reports<br/>
          <% var exceptions_count = hit._source.exceptions ? hit._source.exceptions.length : 0 %>
          <%= exceptions_count %> exception<%= exceptions_count != 1 ? "s" : "" %>
          <% if (exceptions_count > 0) { %>
            <ul class="accordion">
              <% for (var j = 0; j < hit._source.exceptions.length; j++) { %>
                <% var exception = hit._source.exceptions[j]; %>
                <li>
                  <a href="javascript:void(0)" class="js-accordion-trigger">
                    <%= exception.class_name %> thrown in <%= exception.function %> at <%= exception.filename %>:<%= exception.line_num %>
                  </a>
                  <ul class="submenu">
                    <li>
                      <pre><%= exception.traceback %></pre>
                    </li>
                  </ul>
                </li>
              <% } %>
            </ul>
          <% } %>
        </li>
      </ul>
    </li>
  <% } %>
</ul>

<script>
  $(".js-accordion-trigger").bind("click", function(e) {
    $(jQuery(this).parent().find(".submenu")[0]).slideToggle("fast");
    jQuery(this).parent().toggleClass("is-expanded");
    e.preventDefault();
  });
</script>
</body>
</html>
