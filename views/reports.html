<%- include('layout/header.html', {form_tag_open: true}); %>

<section class="center inspector-filter">
    <strong>Agency Filters</strong>
    <select name="inspector" data-placeholder="Select an agency" class="chosen-select" multiple>
        <option value=""></option>
        <% for (var i = 0; i < helpers.inspector_list.length; i++) { -%>
            <% var inspector = helpers.inspector_list[i]; -%>
            <% var selected = (query_obj.inspector && query_obj.inspector.indexOf(inspector.slug) != -1) ? "selected" : ""; -%>
            <option value="<%= inspector.slug %>" <%= selected %>><%= inspector.short_name %></option>
        <% } -%>
    </select>
</section>

<section class="center date-filter">
    <strong>Date Filters</strong>
    <input type="date" name="published_on_start" id="date-start">
    <input type="date" name="published_on_end" id="date-end">
    <span id="date-filter-clear">Clear date filter</span>
</section>

<section class="center filters">
    <% var all_reports = !query_obj.unreleased && !query_obj.foiad && !query_obj.featured %>
    <span>
        <input type="checkbox" id="checkbox-all-reports" class="toggle-input" <%= all_reports ? "checked" : "" %>>
        <label for="checkbox-all-reports" class="toggle-label">
            All Reports
        </label>
    </span>
    <span>
        <input type="checkbox" id="checkbox-unreleased" name="unreleased" value="true" class="toggle-input" <%= query_obj.unreleased ? "checked" : "" %>>
        <label for="checkbox-unreleased" class="toggle-label">
            Unreleased
        </label>
    </span>
    <span>
        <input type="checkbox" id="checkbox-foiad" name="foiad" value="true" class="toggle-input" <%= query_obj.foiad ? "checked" : "" %>>
        <label for="checkbox-foiad" class="toggle-label">
            FOIA'd
        </label>
    </span>
    <span>
        <input type="checkbox" id="checkbox-featured" name="featured" value="true" class="toggle-input" <%= query_obj.featured ? "checked" : "" %>>
        <label for="checkbox-featured" class="toggle-label">
            Editor's Pick
        </label>
    </span>
</section>

</form>

<section class="center reports">
    <% if (results) { %>

        <span class="count">
            <%= helpers.format_number(results.hits.total) %> documents found
        </span>

        <% var hits = results.hits.hits; %>
        <% if (hits.length > 0) { %>
            <ul>
                <% for (var i=0; i<hits.length; i++) { %>
                    <% var report = hits[i]._source; %>
                    <% var highlight = hits[i].highlight; %>
                    <li>
                        <h2>
                            <a href="/reports/<%= report.inspector %>/<%= encodeURIComponent(report.report_id) %>">
                                <%= report.title %></a>
                        </h2>
                        <h4>
                            <a href="/inspectors/<%= report.inspector %>">
                                <%= helpers.inspector_info(report.inspector).name %></a>
                            &mdash;
                            <%= report.agency_name %>
                            &mdash;
                            <%= report.published_on %>
                            <% if (report.url) { %>
                                &mdash;
                                <a href="<%= report.url %>">
                                    Full report</a>
                                <% if (report.file_type == "pdf") { %>
                                    (PDF)
                                <% } %>
                            <% } else if (report.unreleased) { %>
                                &mdash;
                                <% if (report.missing) { %>
                                    Unreleased/Missing
                                <% } else { %>
                                    Unreleased
                                <% } %>
                            <% } %>

                            <% if (report.landing_url) { %>
                                &mdash;
                                <a href="<%= report.landing_url %>">Summary</a>
                            <% } %>
                        </h4>
                        <% if (query_obj.featured && report.featured) { %>
                            <p>
                                <%= report.featured.description %>
                                <br/>
                                &mdash;<a href="<%= report.featured.author_link %>">
                                    <%= report.featured.author %>
                                </a>
                            </p>
                        <% } %>
                        <% if (highlight && (highlight.text || highlight.summary)) { %>
                            <p>
                                <% if (highlight.text) { %>
                                    …<%- helpers.strip_ff(highlight.text[0]) %>…
                                <% } else if (highlight.summary) { %>
                                    …<%- helpers.strip_ff(highlight.summary[0]) %>…
                                <% } %>
                            </p>
                        <% } %>
                    </li>
                <% } %>
            </ul>
        <% } else { %>
            <p>
                No results right now.
            </p>
        <% } %>

        <div class="pagination">
            <% if (query_obj.page > 1) { %>
                <a href="/reports?<%= helpers.format_qs(query_obj, {page: query_obj.page - 1}) %>" class="previous-page">
                    Previous page</a>
            <% } else {%>
                <span class="previous-page">&nbsp;</span>
            <% } %>
            <span class="page-number">Page <%= query_obj.page %></span>
            <% if (results.hits.total > query_obj.page * query_obj.size) { %>
                <a href="/reports?<%= helpers.format_qs(query_obj, {page: query_obj.page + 1}) %>" class="next-page">
                    Next page</a>
            <% } else {%>
                <span class="next-page">&nbsp;</span>
            <% } %>
        </div>

    <% } else { %>
        Error performing the search!
    <% } %>
</section>

<script src="/scripts/jquery.min.js"></script>
<script src="/chosen/chosen.jquery.min.js"></script>
<script src="/scripts/search.js"></script>
<script src="/scripts/nodep-date-input-polyfill.dist.js"></script>

<% include layout/footer.html %>
